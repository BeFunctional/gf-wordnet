<!DOCTYPE html>
<html style="height: 100%">
	<head>
		<title>GF WordNet</title>
		<link rel="stylesheet" type="text/css" href="gf-wordnet.css">
	</head>

	<body style="height: 100%">
		<table style="table-layout:fixed"><tr>
			<td>
				<table id="from" class="multiselect">
					<thead>
						<tr onclick="showCheckboxes(this.parentNode.parentNode)"><th>English</th><th><img src="triangle.png"></th></tr>
					</thead>
					<tbody>
						<tr><td onclick="changeItem(event,this)">Bulgarian</td><td><input type="checkbox" name="ParseBul" checked="true"/></td></tr>
						<tr><td onclick="changeItem(event,this)">Catalan</td><td><input type="checkbox" name="ParseCat"/></td></tr>
						<tr><td onclick="changeItem(event,this)">Chinese</td><td><input type="checkbox" name="ParseChi"/></td></tr>
						<tr><td onclick="changeItem(event,this)">Dutch</td><td><input type="checkbox" name="ParseDut"/></td></tr>
						<tr><td onclick="changeItem(event,this)">English</td><td><input type="checkbox" name="ParseEng" checked="true"/></td></tr>
						<tr><td onclick="changeItem(event,this)">Estonian</td><td><input type="checkbox" name="ParseEst"/></td></tr>
						<tr><td onclick="changeItem(event,this)">Finnish</td><td><input type="checkbox" name="ParseFin"/></td></tr>
						<tr><td onclick="changeItem(event,this)">Italian</td><td><input type="checkbox" name="ParseIta"/></td></tr>
						<tr><td onclick="changeItem(event,this)">Portuguese</td><td><input type="checkbox" name="ParsePor"/></td></tr>
						<tr><td onclick="changeItem(event,this)">Slovenian</td><td><input type="checkbox" name="ParseSlv"/></td></tr>
						<tr><td onclick="changeItem(event,this)">Spanish</td><td><input type="checkbox" name="ParseSpa"/></td></tr>
						<tr><td onclick="changeItem(event,this)">Swedish</td><td><input type="checkbox" name="ParseSwe" checked="true"/></td></tr>
						<tr><td onclick="changeItem(event,this)">Thai</td><td><input type="checkbox" name="ParseTha"/></td></tr>
						<tr><td onclick="changeItem(event,this)">Turkish</td><td><input type="checkbox" name="ParseTur"/></td></tr>
					</tbody>
				</table>
			</td>
			<td><input id="search" type="text" placeholder="Search for a word"></td>
			<td align="right">
				<span id="expand_button" class="expand_button" onclick="expand(this)">&#x21F2;</span>
			    <input id="search_button" type="button" value="Search" onclick="gfwordnet.search(getMultiSelection(element('from')), getSearchQuery(), element('domains'), element('result'), domain_listener); element('search').value = ''">
			</td>
		</tr></table>

		<br>

		<div style="min-height: 85%">
			<table class="selectors" id="domains">
				<thead></thead>
				<tbody></tbody>
			</table>
			<table class="result" id="result">
				<thead></thead>
				<tbody></tbody>
				<tfoot></tfoot>
			</table>
		</div>

		<br>

		<p>
			<a href="gf-wordnet-help.html" target="_blank">What is this?</a>
			<a id="logIn" href="https://github.com/login/oauth/authorize?scope=user:email%20public_repo&client_id=1e94c97e812a9f502068">Log In</a>
			<a id="commit" href="javascript:gfwordnet.commit(this)" style="display: none">Commit</a>
		</p>

		<script src="https://cloud.grammaticalframework.org/js/support.js"></script>
		<script src="js/tsnejs.js"></script>
		<script src="js/gf-wordnet.js"></script>
		<script src="js/wordcloud2.js"></script>
		<script src="js/multiselect.js"></script>
		<script>
			domain_listener = function() {
				gfwordnet.search(getMultiSelection(element('from')), null, element('domains'), element('result'), arguments.callee);
			};
			gfwordnet.populate_domains(element('domains'), domain_listener);

			element("search").addEventListener("keyup", function(event) {
				event.preventDefault();
				if (event.keyCode === 13) {
					element("search_button").click();
				}
			});
			
			function getCookie(cname) {
			  var name = cname + "=";
			  var ca = document.cookie.split(';');
			  for(var i = 0; i < ca.length; i++) {
			    var c = ca[i];
			    while (c.charAt(0) == ' ') {
			      c = c.substring(1);
			    }
			    if (c.indexOf(name) == 0) {
			      return decodeURIComponent(c.substring(name.length, c.length));
			    }
			  }
			  return null;
			}

			function deleteCookie(name) {
			  document.cookie = name + '=; expires=Thu, 01 Jan 1970 00:00:01 GMT;';
			}

			function logOut() {
				gfwordnet.set_user(null,null,0,element('result'),null);
				logIn.innerHTML = "Log In";
				logIn.href = "https://github.com/login/oauth/authorize?scope=user:email%20public_repo&client_id=1e94c97e812a9f502068";
				commit.style.display = "none";
				deleteCookie("user");
				deleteCookie("author");
				deleteCookie("count");
			}

			var user   = getCookie("user");
			var author = getCookie("author");
			var token  = getCookie("token");
			var count  = getCookie("count");
			if (user != null && count != null && author != 0) {
				var logIn  = element('logIn');
				var commit = element('commit');
				logIn.innerHTML = "Log Out "+user;
				logIn.href = "javascript:logOut()"

				gfwordnet.set_user(user,author,token,count,element('result'),commit);
				commit.style.display = "inline";
			}
			
			function expand(expand_button) {
				var row = expand_button.parentNode.parentNode;
				if (expand_button.innerHTML == "\u21F2") {
					var textarea = node("div", {id: "text", contenteditable: true}, []);
					textarea.style.minWidth = (row.clientWidth-10)+"px";
					row.parentNode.appendChild(tr(node("td", {colspan: 3}, [textarea])));
					expand_button.parentNode.previousElementSibling.firstElementChild.style.display="none";
					expand_button.innerHTML = "\u21F1"
				} else {
					row.parentNode.removeChild(row.nextElementSibling);
					expand_button.innerHTML = "\u21F2"
					expand_button.parentNode.previousElementSibling.firstElementChild.style.display="block";
				}
			}
			
			function getSearchQuery() {
				if (element('expand_button').innerHTML == "\u21F2") {
					return element('search').value;
				} else {
					return element('text').innerHTML;
				}
			}
		</script>
	</body>
</html>
